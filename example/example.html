<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fm-promise example</title>
    <script>
      /* FMGofer */
      !function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FMGofer=t():e.FMGofer=t()}(this,(function(){return(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.d(t,{default:()=>n});const n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.promises={},this.nextID=0,this.callbackName=null}var t,n;return t=e,(n=[{key:"setCallbackName",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fmCallback";if("string"!=typeof t||!t)throw new Error("callbackName must be a non-empty string");window[t]=function(t,o,r){e.runCallback(t,o,r)},this.callbackName=t}},{key:"createPromise",value:function(e,t,o,r){var n={resolve:e,reject:t};0!==o&&(n.timeoutID=setTimeout((function(){t(r)}),o));var i=this.nextID;return this.promises[i]=n,this.nextID++,i}},{key:"deletePromise",value:function(e){delete this.promises[e]}},{key:"getPromise",value:function(e){return this.promises[e]}},{key:"runCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"resolve",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{var r=this.getPromise(e);r.timeoutID&&clearTimeout(r.timeoutID),"reject"===t.toLowerCase()?r.reject(o):r.resolve(o),this.deletePromise(e)}catch(e){console.error(e),alert(e)}}},{key:"PerformScriptWithOption",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e3,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"The FM script call timed out";return new Promise((function(a,c){var u,s,f=t.createPromise(a,c,i,l),m=JSON.stringify({promiseID:f,callbackName:t.callbackName,parameter:r});try{u=setInterval((function(){"object"===o(window.FileMaker)&&(clearTimeout(s),clearInterval(u),window.FileMaker.PerformScriptWithOption(e,m,n))}),5),s=setTimeout((function(){throw clearInterval(u),new Error("window.FileMaker not found")}),2e3)}catch(e){throw clearInterval(u),clearTimeout(s),e}}))}},{key:"PerformScript",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"The FM script call timed out",n=null;return this.PerformScriptWithOption(e,t,n,o,r)}}])&&r(t.prototype,n),e}();return t.default})()}));
    </script>
    <!-- <script src="../dist/fm-gofer.js"></script> -->
    <style>
      /* App CSS */
      * {
        font-family: Arial, Helvetica, sans-serif;
        color: #282828;
        margin: 10px;
        text-align: center;
      }
      button {
        padding: 10pt;
        font-size: medium;
        border: .5pt solid #007FB5;
        border-radius: 5pt;
        background-color: #0091CE;
        color: white;
      }
      button:active {
        background-color: #007cb1;
      }
      .message {
        margin-top: 10pt;
        margin-bottom: 10pt;
        font-size: large;
      }
    </style>
    <style>
      /* LOADER CSS https://projects.lukehaas.me/css-loaders/ */
      .loader{color:#9c9c9c;font-size:20px;margin:100px auto;width:1em;height:1em;border-radius:50%;position:relative;text-indent:-9999em;-webkit-animation:load4 1.3s infinite linear;animation:load4 1.3s infinite linear;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0)}@-webkit-keyframes load4{0%,100%{box-shadow:0 -3em 0 .2em,2em -2em 0 0,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 0}12.5%{box-shadow:0 -3em 0 0,2em -2em 0 .2em,3em 0 0 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em 0 0,3em 0 0 .2em,2em 2em 0 0,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 0,2em 2em 0 .2em,0 3em 0 0,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 0,0 3em 0 .2em,-2em 2em 0 0,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 0,-2em 2em 0 .2em,-3em 0 0 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 .2em,-2em -2em 0 0}87.5%{box-shadow:0 -3em 0 0,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 0,-2em -2em 0 .2em}}@keyframes load4{0%,100%{box-shadow:0 -3em 0 .2em,2em -2em 0 0,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 0}12.5%{box-shadow:0 -3em 0 0,2em -2em 0 .2em,3em 0 0 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em 0 0,3em 0 0 .2em,2em 2em 0 0,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 0,2em 2em 0 .2em,0 3em 0 0,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 0,0 3em 0 .2em,-2em 2em 0 0,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 0,-2em 2em 0 .2em,-3em 0 0 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 .2em,-2em -2em 0 0}87.5%{box-shadow:0 -3em 0 0,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 0,-2em -2em 0 .2em}}
    </style>
  </head>
  
  
  
  <body>
    <button id="myButton">Click Me</button>
    <div id="message" class="message">Click the button to get a message</div>
    <div id="loader" class="loader" hidden>Loading...</div>
    <script>
      (function () {
        var fm = new FMGofer();
        fm.setCallbackName();
        
        function handleClick() {
          var script = 'FM Script';
          var param = {message: 'hello from JS', date: new Date()};
          var timeout = 1000;
          var timeoutMessage = 'Custom timeout message (' + timeout + 'ms)';
          updateMessage('Waiting...');
          showLoader();
          fm.PerformScript(script, param, timeout, timeoutMessage)
            .then(function (result) {
              hideLoader();
              updateMessage(result);
            })
            .catch(function(error){
              hideLoader();
              updateMessage(error);
            });
        }
        function showLoader() {
          document.getElementById('loader').hidden = false;
        }
        function hideLoader() {
          document.getElementById('loader').hidden = true;
        }
        function updateMessage(message) {
          document.getElementById('message').innerText = message;
        }

        document.getElementById('myButton').onclick = handleClick;
      })();      
    </script>
    
  </body>


  </html>
