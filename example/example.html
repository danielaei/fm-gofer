<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fm-promise example</title>
    <script>
      /* FMGofer */
      !function(e,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof exports?exports.FMGofer=o():e.FMGofer=o()}(this,(function(){return(()=>{"use strict";var e={d:(o,r)=>{for(var t in r)e.o(r,t)&&!e.o(o,t)&&Object.defineProperty(o,t,{enumerable:!0,get:r[t]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.r(o),e.d(o,{PerformScriptWithOption:()=>p,PerformScript:()=>w});var t=function(){return"object"===r(window.fmGofer)&&null!==window.fmGofer&&!Array.isArray(window.fmGofer)},n=function(){return t()?window.fmGofer.callbackName:null},i=function(){window.fmGofer={promises:{},callbackName:null}},f=function(e,o,r,t){var n={resolve:e,reject:o};0!==r&&(n.timeoutID=setTimeout((function(){o(t)}),r));var i="xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var o=16*Math.random()|0;return("x"==e?o:3&o|8).toString(16)}));return window.fmGofer.promises[i]=n,i},l=function(e){return window.fmGofer.promises[e]},u=function(e){return delete window.fmGofer.promises[e]},c=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{"0"===r&&(r=!1);var t=l(e);if(void 0===t)throw new Error("No promise found for promiseID ".concat(e,"."));t.timeoutID&&clearTimeout(t.timeoutID),r?t.reject(o):t.resolve(o),u(e)}catch(e){console.error(e),alert(e)}},a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fmGoferD7738642C91848E08720EAC24EDDA483";if("string"!=typeof e||!e)throw new Error("callbackName must be a non-empty string");t()||i(),window[e]=c,window.fmGofer.callbackName=e},m=function(e,o,t){var n,i;"object"!==r(window.FileMaker)?(n=setInterval((function(){"object"===r(window.FileMaker)&&(clearTimeout(i),clearInterval(n),window.FileMaker.PerformScriptWithOption(e,o,t))}),5),i=setTimeout((function(){throw clearInterval(n),new Error("window.FileMaker not found")}),2e3)):window.FileMaker.PerformScriptWithOption(e,o,t)},d=3e3,s="The FM script call timed out",p=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:s;if("string"!=typeof e||!e)throw new Error("script must be a string");if("number"!=typeof l)throw new Error("timeout must be a number");if("string"!=typeof u)throw new Error("timeoutMessage must be a string");return new Promise((function(c,d){t()||i(),n()||a();var s=f(c,d,l,u),p=n(),w=JSON.stringify({promiseID:s,callbackName:p,parameter:o});m(e,w,r)}))},w=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s,n=void 0;return p(e,o,n,r,t)};return o})()}));
    </script>
    <!-- <script src="../dist/fm-gofer.js"></script> -->
    <style>
      /* App CSS */
      * {
        font-family: Arial, Helvetica, sans-serif;
        color: #282828;
        margin: 10px;
        text-align: center;
      }
      button {
        padding: 10pt;
        font-size: medium;
        border: .5pt solid #007FB5;
        border-radius: 5pt;
        background-color: #0091CE;
        color: white;
      }
      button:active {
        background-color: #007cb1;
      }
      .message {
        margin-top: 10pt;
        margin-bottom: 10pt;
        font-size: large;
      }
    </style>
    <style>
      /* LOADER CSS https://projects.lukehaas.me/css-loaders/ */
      .loader{color:#9c9c9c;font-size:20px;margin:100px auto;width:1em;height:1em;border-radius:50%;position:relative;text-indent:-9999em;-webkit-animation:load4 1.3s infinite linear;animation:load4 1.3s infinite linear;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0)}@-webkit-keyframes load4{0%,100%{box-shadow:0 -3em 0 .2em,2em -2em 0 0,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 0}12.5%{box-shadow:0 -3em 0 0,2em -2em 0 .2em,3em 0 0 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em 0 0,3em 0 0 .2em,2em 2em 0 0,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 0,2em 2em 0 .2em,0 3em 0 0,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 0,0 3em 0 .2em,-2em 2em 0 0,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 0,-2em 2em 0 .2em,-3em 0 0 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 .2em,-2em -2em 0 0}87.5%{box-shadow:0 -3em 0 0,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 0,-2em -2em 0 .2em}}@keyframes load4{0%,100%{box-shadow:0 -3em 0 .2em,2em -2em 0 0,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 0}12.5%{box-shadow:0 -3em 0 0,2em -2em 0 .2em,3em 0 0 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em 0 0,3em 0 0 .2em,2em 2em 0 0,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 0,2em 2em 0 .2em,0 3em 0 0,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 0,0 3em 0 .2em,-2em 2em 0 0,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 0,-2em 2em 0 .2em,-3em 0 0 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 .2em,-2em -2em 0 0}87.5%{box-shadow:0 -3em 0 0,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 0,-2em -2em 0 .2em}}
    </style>
  </head>
  
  
  
  <body>
    <button id="myButton">Click Me</button>
    <div id="message" class="message">Click the button to get a message</div>
    <div id="loader" class="loader" hidden>Loading...</div>
    <script>
      (function () {
        function handleClick() {
          var script = 'FM Script';
          var param = 'HELLO FROM JS ' + new Date();
          var timeout = 1000;
          var timeoutMessage = 'Custom timeout message (' + timeout + 'ms)';
          updateMessage('Waiting...');
          showLoader();
          FMGofer.PerformScript(script, param, timeout, timeoutMessage)
            .then(function (result) {
              console.log('Entered .then block');
              hideLoader();
              updateMessage(result);
            })
            .catch(function (error){
              console.log('Entered .catch block');
              hideLoader();
              updateMessage(error);
            });
        }
        function showLoader() {
          document.getElementById('loader').hidden = false;
        }
        function hideLoader() {
          document.getElementById('loader').hidden = true;
        }
        function updateMessage(message) {
          document.getElementById('message').innerText = message;
        }

        document.getElementById('myButton').onclick = handleClick;
      })();      
    </script>
    
  </body>


  </html>
